<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ether Nexus | Datos Personales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #050505; 
            color: #ffffff; 
            min-height: 100vh;
        }

        .form-input { 
            background: #0a0a0a; 
            border: 1px solid rgba(255,255,255,0.1); 
            padding: 1rem; 
            width: 100%; 
            color: white; 
            outline: none; 
            transition: 0.3s;
            border-radius: 2px;
        }

        .form-input:focus { 
            border-color: #6366f1; 
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.1);
        }

        .label-text { 
            font-weight: 900;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6366f1;
            margin-bottom: 0.5rem;
            display: block;
        }

        select.form-input {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236366f1' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            appearance: none;
        }

        option { background: #0a0a0a; color: white; }

        .btn-save {
            background: #ffffff;
            color: #000;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            padding: 1.25rem;
            width: 100%;
            transition: 0.4s;
            cursor: pointer;
            margin-top: 2rem;
            border: none;
        }

        .btn-save:hover {
            background: #6366f1;
            color: #fff;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .btn-save:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="p-6 md:p-16">

    <div class="max-w-4xl mx-auto">
        <a href="dashboard.html" class="text-gray-500 text-[10px] font-bold uppercase mb-8 inline-block hover:text-indigo-400 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i> Volver al Workspace
        </a>
        
        <header class="mb-12">
            <h1 class="text-4xl font-black uppercase tracking-tighter mb-2">Expediente de Personal</h1>
            <p class="text-gray-500 text-xs uppercase tracking-widest font-bold">Ether Logic // Core Database Update</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
            
            <div class="flex flex-col items-center">
                <span class="label-text">Fotografía Oficial</span>
                <div class="w-full aspect-square bg-[#0a0a0a] border-2 border-dashed border-white/10 flex flex-col items-center justify-center relative group overflow-hidden cursor-pointer">
                    <div id="imagePreview" class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-user-astronaut text-4xl text-gray-800 group-hover:text-indigo-500 transition-all"></i>
                    </div>
                    <input type="file" id="photoUpload" class="absolute inset-0 opacity-0 cursor-pointer" accept="image/*">
                    <div class="z-10 text-center mt-12">
                        <span class="text-[8px] text-gray-600 font-bold uppercase tracking-widest group-hover:text-gray-400">Click para cargar</span>
                    </div>
                </div>
                <p class="text-[8px] text-gray-600 mt-4 text-center leading-relaxed">FORMATOS: JPG, PNG. <br> MÁXIMO 5MB.</p>
            </div>

            <div class="lg:col-span-2 space-y-6">
                
                <div>
                    <span class="label-text">Nombre Completo</span>
                    <input type="text" id="nombreCompleto" class="form-input uppercase text-xs font-bold" placeholder="EJ: ALEXIS RIVERA">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <span class="label-text">Tipo de Identificación</span>
                        <select id="tipoIdentificacion" class="form-input text-xs font-bold">
                            <option value="DNI">DNI (Documento Nacional)</option>
                            <option value="CI">CI (Cédula de Identidad)</option>
                            <option value="PASAPORTE">Pasaporte Internacional</option>
                            <option value="MIGRATORIO">Certificado Migratorio</option>
                        </select>
                    </div>
                    <div>
                        <span class="label-text">Número de Documento</span>
                        <input type="text" id="numDocumento" class="form-input font-mono text-xs" placeholder="00000000-X">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <span class="label-text">Nacionalidad</span>
                        <select id="nacionalidad" class="form-input text-xs font-bold">
                            <option value="" disabled selected>Seleccionar país...</option>
                            <optgroup label="Latinoamérica & España">
                                <option value="argentina">Argentina</option>
                                <option value="mexicana">Mexicana</option>
                                <option value="colombiana">Colombiana</option>
                                <option value="española">Española</option>
                                <option value="chilena">Chilena</option>
                                </optgroup>
                        </select>
                    </div>
                    <div>
                        <span class="label-text">Fecha de Nacimiento</span>
                        <div class="flex gap-2">
                            <input type="date" id="fechaNacimiento" class="form-input text-xs font-bold">
                            <div class="w-20 bg-indigo-900/30 border border-indigo-500/30 flex flex-col items-center justify-center rounded">
                                <span class="text-[7px] font-black uppercase text-indigo-400">Edad</span>
                                <span id="mostrarEdad" class="text-lg font-black text-white">--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="btnGuardar" class="btn-save">
                    Actualizar Nexus Core
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURACIÓN DE TU PROYECTO FIREBASE
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            projectId: "TU_PROYECTO_ID",
            storageBucket: "TU_PROYECTO.appspot.com",
            messagingSenderId: "TU_SENDER_ID",
            appId: "TU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variables de UI
        const photoUpload = document.getElementById('photoUpload');
        const fechaInput = document.getElementById('fechaNacimiento');
        const btnGuardar = document.getElementById('btnGuardar');

        // 1. Vista previa de imagen
        photoUpload.addEventListener('change', function() {
            const preview = document.getElementById('imagePreview');
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        // 2. Calcular Edad automáticamente
        fechaInput.addEventListener('change', function() {
            const nacimiento = new Date(this.value);
            const hoy = new Date();
            let edad = hoy.getFullYear() - nacimiento.getFullYear();
            const mes = hoy.getMonth() - nacimiento.getMonth();
            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
                edad--;
            }
            document.getElementById('mostrarEdad').innerText = edad >= 0 ? edad : "--";
        });

        // 3. Guardar en Firebase
        btnGuardar.addEventListener('click', async () => {
            const datos = {
                nombre: document.getElementById('nombreCompleto').value,
                tipoDoc: document.getElementById('tipoIdentificacion').value,
                numeroDoc: document.getElementById('numDocumento').value,
                nacionalidad: document.getElementById('nacionalidad').value,
                fechaNacimiento: document.getElementById('fechaNacimiento').value,
                timestamp: new Date()
            };

            // Validar campos mínimos
            if(!datos.nombre || !datos.numeroDoc) {
                alert("ERROR: Credenciales incompletas para Nexus Core.");
                return;
            }

            try {
                btnGuardar.innerText = "SINCRONIZANDO...";
                btnGuardar.disabled = true;

                // Guardamos en la colección 'empleados'
                await addDoc(collection(db, "empleados"), datos);

                alert("DATOS SINCRONIZADOS: Expediente actualizado en Ether Logic.");
                window.location.href = 'dashboard.html';
            } catch (error) {
                console.error("Error: ", error);
                alert("FALLO DE CONEXIÓN: No se pudo contactar con la base de datos.");
                btnGuardar.innerText = "REINTENTAR ACTUALIZACIÓN";
                btnGuardar.disabled = false;
            }
        });
    </script>
</body>
</html>